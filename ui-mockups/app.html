<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSG App Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-shell">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="flex justify-between items-center" style="margin-bottom: var(--space-4);">
                <div class="heading-lg" style="color: var(--color-primary);">VSG.</div>
                <button class="btn btn-ghost" id="closeSidebar" aria-label="Close sidebar" style="padding: 8px 12px;">✕</button>
            </div>

            <div class="group">
                <h3>Data Source</h3>
                <div class="card" style="padding: var(--space-3);">
                    <select style="width: 100%; padding: 10px; border-radius: var(--radius-md); border: 1px solid var(--color-border); background: var(--color-surface-2); color: #fff;">
                        <option>Twitter/X Export</option>
                        <option>Instagram JSON</option>
                        <option>LinkedIn Connections</option>
                        <option>Custom JSON</option>
                    </select>
                    <p class="body-md" style="margin-top: var(--space-2);">Processing stays local. No tokens. No APIs.</p>
                </div>
            </div>

            <div class="group">
                <h3>Communities</h3>
                <div class="flex gap-2" style="flex-wrap: wrap;">
                    <span class="chip" style="border-color: rgba(249,115,22,0.5);">All (247)</span>
                    <span class="chip" style="border-color: #22d3ee; color:#22d3ee;">Tech Twitter (84)</span>
                    <span class="chip" style="border-color: #a855f7; color:#a855f7;">Local Friends (63)</span>
                    <span class="chip" style="border-color: #f59e0b; color:#f59e0b;">Conference (45)</span>
                </div>
            </div>

            <div class="group">
                <h3>Engagement</h3>
                <div class="card" style="padding: var(--space-3); display: grid; gap: var(--space-2);">
                    <label class="flex justify-between"><span>Super Fans</span><span class="chip" style="border-color: rgba(16,185,129,0.5); color:#10B981;">92</span></label>
                    <label class="flex justify-between"><span>Active</span><span class="chip" style="border-color: rgba(249,115,22,0.5); color:var(--color-primary);">118</span></label>
                    <label class="flex justify-between"><span>Ghosts</span><span class="chip" style="border-color: rgba(239,68,68,0.5); color:#EF4444;">37</span></label>
                </div>
            </div>

            <div class="group">
                <h3>Influence Score</h3>
                <div class="card" style="padding: var(--space-3);">
                    <div class="flex justify-between body-md" style="margin-bottom: var(--space-2);"><span>Threshold</span><span style="color: var(--color-primary);">≥ 80</span></div>
                    <input type="range" min="0" max="100" value="80" style="width: 100%; accent-color: var(--color-primary);">
                </div>
            </div>

            <div class="group">
                <h3>Local Processing</h3>
                <div class="card" style="padding: var(--space-3);">
                    <div class="flex justify-between body-md" style="margin-bottom: var(--space-2);">
                        <span>Calculating centrality…</span>
                        <span style="color: var(--color-primary);">65%</span>
                    </div>
                    <div class="progress-bar" style="height:6px;">
                        <div class="progress-fill" style="width:65%;"></div>
                    </div>
                    <p class="body-md" style="margin-top: var(--space-2);">Runs in Web Workers. Nothing leaves your device.</p>
                </div>
            </div>
        </aside>

        <!-- Mobile toggle -->
        <button class="btn btn-ghost" id="openSidebar" style="position: fixed; top: var(--space-4); left: var(--space-4); z-index: 60;">☰ Filters</button>

        <!-- Main Canvas -->
        <main class="main-canvas" id="canvas" aria-label="Graph Canvas">
            <div class="canvas-overlay" id="guidedOverlay">
                <svg width="100%" height="100%" viewBox="0 0 1000 700" preserveAspectRatio="xMidYMid slice">
                    <defs>
                        <linearGradient id="edgeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="rgba(249,115,22,0.6)" />
                            <stop offset="100%" stop-color="rgba(249,115,22,0.1)" />
                        </linearGradient>
                    </defs>
                    <!-- Stage 1: Center -->
                    <circle id="nodeYou" cx="500" cy="350" r="14" fill="#F97316" opacity="0" />
                    <!-- Stage 2: Inner circle nodes -->
                    <g id="innerCircle" opacity="0">
                        <circle cx="400" cy="280" r="8" fill="#F97316" />
                        <circle cx="600" cy="260" r="8" fill="#F97316" />
                        <circle cx="620" cy="430" r="8" fill="#F97316" />
                        <circle cx="380" cy="440" r="8" fill="#F97316" />
                        <line x1="500" y1="350" x2="400" y2="280" stroke="url(#edgeGrad)" stroke-width="2" />
                        <line x1="500" y1="350" x2="600" y2="260" stroke="url(#edgeGrad)" stroke-width="2" />
                        <line x1="500" y1="350" x2="620" y2="430" stroke="url(#edgeGrad)" stroke-width="2" />
                        <line x1="500" y1="350" x2="380" y2="440" stroke="url(#edgeGrad)" stroke-width="2" />
                    </g>
                    <!-- Stage 3: Full network (dim layer) -->
                    <g id="fullNetwork" opacity="0.06">
                        <g id="edgesLayer"></g>
                        <g id="nodesLayer"></g>
                    </g>
                    <!-- Stage 4: Spotlight bridge -->
                    <g id="spotlight" opacity="0">
                        <circle cx="760" cy="320" r="10" fill="#22d3ee" />
                        <line x1="500" y1="350" x2="760" y2="320" stroke-dasharray="6 6" stroke="#22d3ee" stroke-width="2" />
                    </g>
                </svg>
            </div>

            <div class="card glass" style="position: absolute; top: var(--space-4); right: var(--space-4); width: 320px;">
                <div class="eyebrow">Network Metrics</div>
                <div class="heading-lg" style="margin: var(--space-2) 0;">Live Overview</div>
                <div class="flex justify-between body-md" style="margin-bottom: var(--space-2);"><span>Nodes</span><span id="metricNodes">1,240</span></div>
                <div class="flex justify-between body-md" style="margin-bottom: var(--space-2);"><span>Edges</span><span id="metricEdges">5,402</span></div>
                <div class="flex justify-between body-md" style="margin-bottom: var(--space-2);"><span>Density</span><span id="metricDensity">0.21</span></div>
                <div class="flex justify-between body-md"><span>Clustering Coef.</span><span id="metricCluster">0.42</span></div>
            </div>

            <div class="insight-card" id="insightCard">
                <div class="eyebrow">Spotlight</div>
                <div class="heading-lg" style="margin: var(--space-2) 0;">Bridge Connection Found</div>
                <p class="body-md" style="color: var(--color-text-main);">This node connects you to 200+ people in a separate cluster. Engage to unlock a new audience.</p>
                <div class="flex gap-4" style="margin-top: var(--space-3);">
                    <button class="btn btn-primary" id="viewInGraph">View in Graph</button>
                    <button class="btn btn-ghost" id="dismissInsight">Dismiss</button>
                </div>
            </div>
        </main>

        <!-- Mobile bottom sheet -->
        <div class="bottom-sheet" id="bottomSheet" aria-label="Insight Sheet">
            <div class="eyebrow">Spotlight</div>
            <div class="heading-lg" style="margin: var(--space-2) 0;">Bridge Connection</div>
            <p class="body-md" style="margin-bottom: var(--space-3);">Connect with Tara_Lifts to reach 200+ fitness creators outside your current circle.</p>
            <div class="flex gap-4">
                <button class="btn btn-primary" style="flex:1;">View in Graph</button>
                <button class="btn btn-ghost" style="flex:1;" id="closeSheet">Close</button>
            </div>
        </div>
    </div>

    <script type="module">
        import mockData from './mock_data.js';

        const sidebar = document.getElementById('sidebar');
        const openSidebar = document.getElementById('openSidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const nodeYou = document.getElementById('nodeYou');
        const inner = document.getElementById('innerCircle');
        const fullNetwork = document.getElementById('fullNetwork');
        const spotlight = document.getElementById('spotlight');
        const insightCard = document.getElementById('insightCard');
        const bottomSheet = document.getElementById('bottomSheet');

        openSidebar.addEventListener('click', () => sidebar.classList.add('open'));
        closeSidebar.addEventListener('click', () => sidebar.classList.remove('open'));

        // Guided Reveal sequence (10s total)
        function guidedReveal() {
            // Stage 1: Center
            nodeYou.style.opacity = 1;
            nodeYou.style.animation = 'pulse 2s ease-in-out infinite';

            // Stage 2: Inner circle
            setTimeout(() => { inner.style.opacity = 1; }, 2000);

            // Stage 3: Full network batch fade
            setTimeout(() => {
                fullNetwork.style.opacity = 0.35;
                drawGraph();
            }, 5000);

            // Stage 4: Spotlight bridge
            setTimeout(() => { spotlight.style.opacity = 1; }, 8000);

            // Stage 5: Show controls / insights
            setTimeout(() => {
                insightCard.classList.add('show');
                bottomSheet.classList.add('show');
            }, 10000);
        }

        function drawGraph() {
            const nodesLayer = document.getElementById('nodesLayer');
            const edgesLayer = document.getElementById('edgesLayer');
            const colors = {
                tech: '#22d3ee',
                local: '#a855f7',
                conf: '#f59e0b',
                bridge: '#10b981',
                core: '#F97316',
                default: '#9CA3AF'
            };

            const positions = new Map();
            const baseRadius = 180;
            const radiusSpread = 240;

            mockData.nodes.slice(0, 140).forEach((n, idx) => {
                const angle = Math.random() * Math.PI * 2;
                const radius = baseRadius + Math.random() * radiusSpread;
                const cx = 500 + Math.cos(angle) * radius;
                const cy = 350 + Math.sin(angle) * radius;
                positions.set(n.id, { cx, cy });

                const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                dot.setAttribute('cx', cx);
                dot.setAttribute('cy', cy);
                dot.setAttribute('r', 4.5);
                dot.setAttribute('fill', colors[n.cluster] || colors.default);
                dot.setAttribute('opacity', 0.95);
                nodesLayer.appendChild(dot);
            });

            mockData.links.slice(0, 80).forEach((l, idx) => {
                const a = positions.get(l.source);
                const b = positions.get(l.target);
                if (!a || !b) return;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', a.cx);
                line.setAttribute('y1', a.cy);
                line.setAttribute('x2', b.cx);
                line.setAttribute('y2', b.cy);
                line.setAttribute('stroke', 'rgba(255,255,255,0.08)');
                line.setAttribute('stroke-width', 1 + (l.weight || 1) * 0.15);
                line.setAttribute('opacity', 0.9);
                edgesLayer.appendChild(line);
            });
        }

        guidedReveal();
    </script>
</body>
</html>
